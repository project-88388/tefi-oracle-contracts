"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const command_1 = require("@oclif/command");
const feather_js_1 = require("@terra-money/feather.js");
const config_1 = require("../config");
const flag = tslib_1.__importStar(require("../lib/flag"));
const TerrainCLI_1 = tslib_1.__importDefault(require("../TerrainCLI"));
class Query extends command_1.Command {
    async run() {
        var _a, _b;
        const { args, flags } = this.parse(Query);
        const prefix = feather_js_1.AccAddress.getPrefix(args.contract);
        const connections = (0, config_1.loadConnections)(prefix);
        const connection = connections(flags.network);
        const lcd = new feather_js_1.LCDClient({ [connection.chainID]: connection });
        try {
            const res = await lcd.wasm.contractQuery(args.contract, JSON.parse(args.msg));
            TerrainCLI_1.default.success(`Query Result:\n \n ${JSON.stringify(res)}`);
        }
        catch (err) {
            let errMsg = 'There was an error with your query. \n\n';
            if (err instanceof SyntaxError) {
                errMsg += ('Make sure you have single quotes around your query and double quotes around query keys.');
            }
            else {
                errMsg += (JSON.stringify(((_b = (_a = err.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.message) || err.message || err, null, 2));
            }
            TerrainCLI_1.default.error(errMsg);
        }
    }
}
Query.description = 'Query contracts on the interchain';
Query.examples = [
    '$ terrain query terra1..fx9fs \'{"get_count": {}}\'',
    '$ terrain query juno1..af00x \'{"get_count": {}}\' --network testnet --config-path ../config.terrain.json ',
];
Query.flags = {
    network: flag.network,
    'config-path': flag.configPath,
};
Query.args = [{
        name: 'contract', required: true, description: 'Contract address', type: 'string',
    },
    {
        name: 'msg', required: true, description: 'Query msg to be performed in JSON format', type: 'string',
    }];
exports.default = Query;
